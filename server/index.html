<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>华成工控Markdown文档转换工具</title>
</head>

<body>
    <h1>华成工控Markdown文档转换工具</h1>
    <form id="markdownform" method="POST" action="/process" enctype="multipart/form-data">
        Markdown文件zip包: <label><input name="doctype" type="radio" value="html" />html</label> <label><input
            name="doctype" type="radio" value="pdf" checked />pdf</label> <label><input name="doctype" type="radio"
            value="docx" />docx</label>  
        <input type="file" id="uploadfile" name="zippacket" accept=".zip" />
        <input type="button" value="删除" onclick="markdownform.reset()">
        <input type="submit" value="提交">
    </form> 
    <form  method="post"> Markdown文本: <label><input name="doctype" type="radio" value="html" />html</label> <label><input
                name="doctype" type="radio" value="pdf" checked />pdf</label> <label><input name="doctype" type="radio"
                value="docx" />docx</label>  
        <input type="submit" value="提交">
        <div style="clear:both;overflow:hidden">
            <div style="float:left; width: 340px;">
                <textarea width="100%" name="markdowntext" rows="30" cols="50"> </textarea>
            </div>
            <div style="float:right; width: 800px; margin-right: 20px;;">
                <pre>
Markdown 例子：
---
title: "R6系统说明书"
subtitle: "取片工艺包说明"
keywords: [取片,工艺]
listings-disable-line-numbers: true
listings-no-page-break: true
product_type: r6

version: A0
doc_id: WI-RD-051

---

<style type="text/css">
.alarm{
    color:#ff0000;
}

.opt{
    color:#4284C9;
}
</style>

# 前言

本说明指导用户使用华成机器人系统的取片工艺包。取片工艺包可适用于自动抓取玻璃，薄片等应用场景。简化编程操作。

## 修改记录

**类别：A- 增加  M- 修改  D- 删除**

| 序号 | 版本号 | 类别 |                修订内容                |     日期      | 修订人 | 审核 |
| :--- | :----- | :--- | :---------------------------------  | :------------| :---- | :--- |
| 1    | A0    | A    | 1. 首版指导                           | 2020年11月4日 | 程国醒 |      |

## 注意

使用本模块会占用系统的如下资源，使用前请确保资源没有冲突。

1. 计数器0和计数器1
2. 中间变量M010
3. 地址800~811
4. 自定义报警9000

\newpage

# 准备工作

在开始使用取片工艺包之前,请先按本章步骤做好软件配置。

## 参数配置

1. 确定手控版本号大于等于**2.0.2.5**, 主机版本号大于**7.8.05**。<span class = "alarm">**(必须)**</span>
2. 进入【参数设定】->【产品设定】->【工艺设定】里面查看是否开启了取片工艺。<span class = "alarm">**(必须)**</span>    
   按如下{@fig:启用取片工艺}设定：

    ![启用取片工艺](imgs/启用取片工艺.png){#fig:启用取片工艺}

\newpage

# 工艺包页面说明

在【参数设定】->【产品设定】->【工艺设定】页面里开启喷涂工艺后, 在教导的工艺页面就会出现取片工艺包的操作页面。如下{@fig:教导取片工艺页面入口}：

![教导取片工艺页面入口](imgs/教导取片工艺页面入口.png){#fig:教导取片工艺页面入口}

点击红色框区域（【取片工艺】按钮）打开工艺设定页面。

在解释各个参数功能之前。先描述探料的工作流程。如下流程{@fig:探料的工作流程}：

```{ .plantuml caption=探料的工作流程 #fig:探料的工作流程 }
@startuml
skinparam dpi 300
start
:运行到探料起点;
if (首模？) then (是)
:慢速探料到最大位置;
else (否)
:快速运行到上次取料点;
:慢速运行一个取料间隔探料;
endif
if (取料成功？) then (是)
    :回退到探料起点;
else (否)
    :换堆继续探或回退到探料起点;
endif
stop

@enduml
```
每次探料开始都运行到被探堆的起点位置，由于吸盘的效应需要时间，所以本工艺取料分为两个阶段，先快速运行到上次取料点附近，接着会速度变慢进行慢速探料。这样可以保护料片，避免过度受力。

## 基础操作页面介绍

打开取片工艺页面后，应如下{@fig:取片工艺页面}显示：

![取片工艺页面](imgs/取片工艺页面.png){#fig:取片工艺页面}

要使用取片工艺，本系统假定机械人的取料方向是基本平行于机器人工作空间的X或者Y或者Z方向。即机器人的探料方向需基本垂直于被取料平面。如下{@fig:取片示意工作台}示：

![取片示意工作台](imgs/取片示意工作台.png){#fig:取片示意工作台}

在该前提下，如取片示意图所标注的数字流程按进行参数设置：

1. 设定探料方向。选择选项为[X,Y,Z],指定机器人取料方向。确定方向后，起点设定区域（2）的堆数的轴会相应改变。
2. 设定探堆参数。探堆参数根据需要的探料堆数设置。参数说明如下：
   1. 起点坐标：首堆的探料起点。起点加上【最大深度】就是最大的探料位置。可以把机器人手动运动到目标点，点击【设入】按钮即可自动设入坐标值。试行按钮可以让机器人再运行到起点。
   2. 堆数：最小值为1，确定每个方向的堆数。
   3. 间距：确定每个方向的堆间距。
3. 探料距离与限制。
   1. 探料距离：根据料厚来确定，一般设定为比料厚大一点即可。
   2. 最大深度：从每堆的探料起点开始，往探料方向运行的最大距离。如果到了最大距离都还没有取到料，可以选择换堆或者结束该次探料。
4. 设定治具信号。需要设定治具的输出信号和取料成功后的输入信号。
   1. 点击输出设定会打开如下对话框：
   
   ![输出点设定页面](imgs/输出点设定页面.png){#fig:输出点设定页面}

   点击【添加】按钮可以添加更多输出点。完成后点击【确定】，不行更改点击【取消】。添加输出点后取片工艺页面会显示已使用的输出点，如下{@fig:取片输出点设定后效果}：

   ![取片输出点设定后效果](imgs/取片输出点设定后效果.png){#fig:取片输出点设定后效果}

   2. 点击输入设定会打开如下对话框：

   ![输入点设定页面](imgs/输入点设定页面.png){#fig:输入点设定页面}

   点击【添加】按钮可以添加更多输出点。完成后点击【确定】，不行更改点击【取消】。根据输入信号的电平选择通或者断。添加输入点后取片工艺页面会显示已使用的输入点，如下{@fig:取片输入点设定后效果}：

   ![取片输入点设定后效果](imgs/取片输入点设定后效果.png){#fig:取片输入点设定后效果}

5. 设定探料运行参数。
   1. 顺序：换堆的顺序。
   2. 起点速度：探料前，运行到起点的速度和探料成功后，回退到起点的速度。
   3. 快探速度和慢探速度：探料分为两个阶段运行。第一个阶段是快速运行到上次取片成功的附近位置。【快探速度】设定改阶段的速度。第二阶段是慢速探料，该阶段慢速运行，防止快速压压坏料片。该阶段运行过程中，设定的输入信号条件满足即会停止或者运行到最大探料位置停止。【慢探速度】设定改阶段的速度。
   4. 台面偏差：对与料堆在Z方向的时候有坡度的时候使用，偏差值为首片到末片的Z高度差。设定后系统会自动补偿X或者Y方向探料过程，让每次取料尽可能的取到料片的相同位置。
6. 其它控制选项
   1. 探前开阀：在探料步骤运行前打开设定的输出点。
   2. 探败换堆：如果探料过程到了最大位置都没取到料，则直接回退到该堆起点，然后移动到下一堆继续探料。
7. 载入与保持设定参数
   1. 获取模块参数：选择已经生成的探料模块可以直接获取到之前保持的取片参数。
   2. 保存：点击【保存】按钮会弹出如下对话框：

    ![保存到模块页面](imgs/保存到模块页面.png){#fig:保存到模块页面}

    选择新建模块的话会从新生成一个模块。选择插入到现有模块会**覆盖**当前模块内容。

## 模块内容说明

生成模块内容后，其基本的框架内容如下：

```
  0:        
            探料方向:2;顺序:0;
            Y堆数:1;Z堆数:1;
            Y间距:10.000;Z间距:10.000;探料距离:5.000;最大进深:100.000;
            输出:0|0;输入:0|0;
            起始点:(0.000,0.000,0.000,0.000,0.000,0.000);
            起点速度:10.0;快探速度:50.0;慢探速度:10.0;台面偏移:0.000;
            探前开阀:true;探败换堆:false
  1:        如果:计数器[0][T:0][C:0]:取片总计数 ==0 跳转到标签[0]:.
  2:        如果:左地址值:800 != 右数据值:0 跳转到标签[1]:.
  3:        如果:左地址值:801 != 右数据值:0 跳转到标签[1]:.
  4:        如果:左地址值:802 != 右数据值:0 跳转到标签[1]:.
  5:        如果:左地址值:803 != 右数据值:0 跳转到标签[1]:.
  6:        如果:左地址值:804 != 右数据值:0 跳转到标签[1]:.
  7:        如果:左地址值:805 != 右数据值:0 跳转到标签[1]:.
  8:        标签[0]:初始化开始
  9:        输出:M010通 延时:0
 10:        标签[1]:初始化结束
 11:        如果:M010断 限时:0.0 跳转到标签[4]:
 12:        如果:计数器[1][T:1][C:0]:已取堆计数 ==0 跳转到标签[10]:.
 13:        如果:计数器[1][T:1][C:0]:已取堆计数 大于等于目标值跳转到标签[2]:.
 14:        标签[10]:堆-1 起始点
 15:        姿势直线:下一位置:X:0,Y:0.000,Z:0.000,U:0
            速度:10.0 延时:0 平滑:无
 16:        存储当前世界坐标XYZUVW到地址： 806,长度：6;偏移：X:0;Y:0;Z:0;
            U:0;V:0;W:0
 17:        跳转到标签[4]:
 18:        标签[4]:快速探料
 19:        停止动作：开始检测 IO:X10通停止当前动作
 20:        如果:M010通 限时:0.0 跳转到标签[6]:
 21:        快速探料 姿势直线引用地址： 800;长度：6;速度:50.0;延时:0 平滑等级:9
 22:        标签[5]:慢速探料
 23:        同步开始
 24:        输出:绿灯通 延时:0
 25:        同步结束
 26:        正常慢探 相对姿势直线:下一位置:X:5.000,Y:0.000,Z:0.000,U:0.000
            速度:10.0 延时:0 平滑:无
 27:        跳转到标签[7]:
 28:        标签[6]:堆首模慢探
 29:        同步开始
 30:        输出:绿灯通 延时:0
 31:        同步结束
 32:        堆首模慢探 相对姿势直线:下一位置:X:100,Y:0.000,Z:0.000,U:0.000
            速度:10.0 延时:0 平滑:无
 33:        标签[7]:探料结束
 34:        输出:M010断 延时:0
 35:        停止动作：结束检测 IO:X10
 36:        如果:X010断 限时:0.0 跳转到标签[9]:
 37:        标签[8]:探料成功
 38:        存储当前世界坐标XYZUVW到地址： 800,长度：6;偏移：X:-5;Y:0;Z:0;
            U:0;V:0;W:0
 39:        探料成功 单纯累加计数器[0][T:0][C:0]:取片总计数
 40:        跳转到标签[3]:
 41:        标签[9]:探料失败
 42:        存储当前世界坐标XYZUVW到地址： 800,长度：6;偏移：X:0;Y:0;Z:0;
            U:0;V:0;W:0
 43:        重新探料 如果:X当前世界坐标 < 100.000 跳转到标签[4]:.
 44:        回到堆起点 姿势直线引用地址： 806;长度：6;速度:50.0;延时:0 平滑:无
 45:        换堆 累加计数器[1][T:1][C:0]:已取堆计数
 46:        输出:M010通 延时:0
 47:        如果:计数器[1][T:1][C:0]:已取堆计数 大于等于目标值跳转到标签[2]:.
 48:        跳转到标签[3]:
 49:        标签[2]:全部取完
 50:        全部取完报警 报警:9000:
 51:        标签[3]:取片完成
 52:        模块结束

```
该模块有如下几个需要了解的点，方便后面编写放料的逻辑。

1. 第0步是取片工艺设定的参数内容，该步为注释，运行过程不执行。
2. 模块里会用到两个计数器。
   1. 【计数器0：取片总数计数】：可以用来查看已经取了多少片。
   2. 【计数器1：已取堆计数】：监控已经取了多少堆，如果当前计数已经到达目标堆数，则报警9000。该报警为自定义报警，可以通过【IO改字软件】修改报警改字内容。
3. 模块里会用到中间变量M010，如果为通说明为首次探料。
4. 模块里会用到两组地址。
   1. 800～805：用于保存上一次的取料位置
   2. 806~811：用户保存堆起点位置
5. 模块里会用到自定义报警9000，如果取完就会报警。

\newpage

# 程序教导例程

1. 取料放料流程，取料失败报警。

```
主程序:
  0:        探料前安全位 自由路径:下一位置:J1:0,J2:0,J3:0,J4:0,J5:0,J6:0
            速度:80.0 延时:0.00 平滑:无
  1:        取片 调用 模块[0]:取片-X-1X1 然后返回到下一行
  2:        如果:X010通 限时:0.0 跳转到标签[0]:
  3:        取料失败报警 报警:9001:报警号9001
  4:        标签[0]:取料成功
  5:        运行到放料点 自由路径:下一位置:J1:100.000,J2:0,J3:10.000,J4:0,J5:0,J6:0
            速度:80.0 延时:0.00 平滑:无
  6:        放料 输出:Y016通 延时:0.0
  7:        模组结束
```


                    </pre>
            </div>

        </div>
    </form>

</body>

</html>